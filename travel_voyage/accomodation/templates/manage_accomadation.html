
<body>
    <div class="container mt-5">
       
        <!-- Button to trigger the Add Accommodation modal -->
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addAccommodationModal">Add Accommodation</button>

        <!-- Add Accommodation Modal -->
        <div class="modal fade" id="addAccommodationModal" tabindex="-1" aria-labelledby="addAccommodationModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form method="POST" enctype="multipart/form-data" action="{% url 'add_accommodation' %}">
                        {% csrf_token %}
                        <div class="modal-header">
                            <h5 class="modal-title" id="addAccommodationModalLabel">Add Accommodation</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            {{ accommodation_form.as_p }}
                            <label for="images">Upload Images</label>
                            <div id="image-upload-container">
                                <div class="mb-2">
                                    <input type="file" name="images" class="form-control">
                                </div>
                            </div>
                            <button type="button" id="add-more-images" class="btn btn-secondary btn-sm">Add More Images</button>
                        </div>
                        <div class="modal-footer">
                           <button type="submit" class="btn btn-primary">Add Accommodation</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Table to display existing accommodations -->
        <table class="table table-bordered mt-3">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Destination</th>
                    <th>Address</th>
                    <th>Price/Night</th>
                    <th>Amenities</th>
                    <th>Contact</th>
                    <th>Images</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for accommodation in accommodations %}
                <tr>
                    <td>{{ accommodation.name }}</td>
                    <td>{{ accommodation.destination.place }}</td>
                    <td>{{ accommodation.address }}</td>
                    <td>${{ accommodation.price_per_night }}</td>
                    <td>{{ accommodation.amenities }}</td>
                    <td>{{ accommodation.contact_number }}</td>
                    <td>
                        {% for image in accommodation.images.all %}
                            <img src="{{ image.image.url }}" alt="Accommodation Image" style="width: 50px; height: 50px; margin-right: 5px;">
                        {% endfor %}
                    </td>
                    <td>
                        <!-- Edit Button triggers the edit modal -->
                        <a href="{% url 'edit_accommodation' accommodation.id %}" class="btn btn-warning btn-sm">
                            <i class="fa fa-edit"></i> Edit
                        </a><a href="{% url 'delete_accommodation' accommodation.id %}" class="btn btn-danger"
                           onclick="return confirm('Are you sure you want to delete this accommodation?');">Delete</a>
                    </td>
                </tr>

                <!-- Edit Accommodation Modal -->
                <div class="modal fade" id="editAccommodationModal-{{ accommodation.id }}" tabindex="-1" aria-labelledby="editAccommodationModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form method="POST" enctype="multipart/form-data" action="{% url 'edit_accommodation' accommodation.id %}">
                                {% csrf_token %}
                                <div class="modal-header">
                                    <h5 class="modal-title" id="editAccommodationModalLabel">Edit Accommodation</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    {{ accommodation_form.as_p }}
                                    <label for="images">Upload New Images</label>
                                    <div id="image-edit-container-{{ accommodation.id }}">
                                        <div class="mb-2">
                                            <input type="file" name="images" class="form-control">
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-secondary btn-sm add-more-edit-images" data-container="image-edit-container-{{ accommodation.id }}">Add More Images</button>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="submit" class="btn btn-primary">Save Changes</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- JavaScript to Handle Adding More Images -->
    <script>
        document.getElementById('add-more-images').addEventListener('click', function() {
            const container = document.getElementById('image-upload-container');
            const newInput = document.createElement('div');
            newInput.classList.add('mb-2');
            newInput.innerHTML = '<input type="file" name="images" class="form-control">';
            container.appendChild(newInput);
        });

        document.querySelectorAll('.add-more-edit-images').forEach(button => {
            button.addEventListener('click', function() {
                const containerId = this.getAttribute('data-container');
                const container = document.getElementById(containerId);
                const newInput = document.createElement('div');
                newInput.classList.add('mb-2');
                newInput.innerHTML = '<input type="file" name="images" class="form-control">';
                container.appendChild(newInput);
            });
        });
    </script>
</body>